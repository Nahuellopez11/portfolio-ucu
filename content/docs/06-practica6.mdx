---
title: PrÃ¡ctica 6
description: Transformando datos inmobiliarios - Pipeline anti-leakage para predicciones justas
---

# PrÃ¡ctica 6: Transformando datos inmobiliarios: pipeline anti-leakage para predicciones justas


## Metadatos del Proyecto

- **Autores:** JoaquÃ­n Batista, Milagros Cancela, ValentÃ­n RodrÃ­guez, Alexia Aurrecoechea, Nahuel LÃ³pez (G1)
- **Fecha:** Agosto 2025
- **Unidad TemÃ¡tica:** UT2 - Calidad & Ã‰tica
- **Tipo:** PrÃ¡ctica Guiada
- **Entorno:** Python + Pandas + Scikit-learn + Seaborn
- **Dataset:** Ames Housing Dataset (2930 registros, 82 variables)

## DescripciÃ³n General

Esta prÃ¡ctica se enfoca en uno de los aspectos mÃ¡s crÃ­ticos del preprocessing en Machine Learning: Feature Scaling y la prevenciÃ³n de Data Leakage. A travÃ©s de una exploraciÃ³n prÃ¡ctica con el dataset Ames Housing, investigamos diferentes tÃ©cnicas de escalado, transformaciones avanzadas, y la implementaciÃ³n de pipelines robustos.

## Objetivos Principales

- Identificar features del dataset Ames que requieren escalado y entender por quÃ©
- Experimentar con MinMaxScaler, StandardScaler y RobustScaler en datos reales
- Descubrir el impacto del escalado en diferentes algoritmos de ML
- Comparar pipelines con y sin data leakage para evidenciar las diferencias
- Implementar transformadores avanzados y evaluar su efectividad

## TecnologÃ­as y Herramientas

**Python con bibliotecas especializadas:**
- **scikit-learn**: Preprocessing, pipelines, y validaciÃ³n cruzada
- **pandas y numpy**: ManipulaciÃ³n y anÃ¡lisis de datos
- **matplotlib y seaborn**: VisualizaciÃ³n de distribuciones y transformaciones
- **scipy.stats**: AnÃ¡lisis estadÃ­stico de asimetrÃ­a

## Dataset y MetodologÃ­a

**Dataset:** Ames Housing (continuaciÃ³n de prÃ¡cticas anteriores)

- **Dimensiones:** 2,930 registros Ã— 82 columnas
- **Variables numÃ©ricas:** 39 columnas con escalas muy diferentes
- **Target:** SalePrice (predicciÃ³n de precios de casas)

**Acceso al notebook completo:** [PrÃ¡ctica 6 - Feature Scaling & Anti-Leakage Pipeline](#)

## AnÃ¡lisis de Algunas Escalas ProblemÃ¡ticas

| Variable | Rango (minâ€“max) | Ratio | Â¿ProblemÃ¡tica? |
|----------|-----------------|-------|----------------|
| Lot Area | 1,300 â€“ 215,245 | 165.57 | âœ… Muy sesgada, outliers extremos |
| SalePrice | 12,789 â€“ 755,000 | 59.04 | âœ… Rango amplio, afecta distancias |
| Gr Liv Area | 334 â€“ 5,642 | 16.89 | âš ï¸ Moderadamente problemÃ¡tica |
| Overall Qual | 1 â€“ 10 | 10.00 | âŒ Escala controlada |

## Experimentos Realizados

### 1. ComparaciÃ³n de Scalers Tradicionales

**StandardScaler vs MinMaxScaler vs RobustScaler**

- AnÃ¡lisis de impacto en detecciÃ³n de outliers
- EvaluaciÃ³n con diferentes algoritmos (KNN, SVM, Linear Regression)
- **Resultado:** StandardScaler mostrÃ³ mejor consistencia para modelos lineales

### 2. Transformaciones Avanzadas

#### PowerTransformer (Yeo-Johnson)
- **Objetivo:** Reducir asimetrÃ­a y estabilizar varianza
- **Resultado en SalePrice:** Skew 1.74 â†’ 0.002, Outliers IQR 137 â†’ 59
- **ConclusiÃ³n:** Excelente para variables con fuerte sesgo

#### QuantileTransformer
- **Objetivo:** Mapear a distribuciÃ³n normal por cuantiles
- **Ventaja:** Muy robusto a outliers extremos
- **LimitaciÃ³n:** Puede "aplastar" extremos con pocos datos

#### Log Transform (log1p seguro)
- **Aplicado a:** Lot Area (skew = 12.814)
- **Resultado:** Skew 12.814 â†’ -0.498
- **ImplementaciÃ³n:** Manejo seguro de valores â‰¤ 0 con shift automÃ¡tico

### 3. Orden de Operaciones: Outliers vs Escalado

**Hallazgo clave:** El escalado modifica la detecciÃ³n de outliers

- **Antes del escalado:** IQR detecta 137 outliers
- **DespuÃ©s del escalado:** IQR detecta 107 outliers
- **RecomendaciÃ³n:** Tratar outliers antes del escalado

## Data Leakage: El Experimento CrÃ­tico

### ComparaciÃ³n de 3 MÃ©todos

| MÃ©todo | RMSE | DescripciÃ³n |
|--------|------|-------------|
| Con Leakage | 32,185 | Escalar todo â†’ Split (INCORRECTO) |
| Sin Leakage Manual | 32,287 | Split â†’ Escalar (CORRECTO) |
| Pipeline + CV | 30,651 | Anti-leakage automÃ¡tico (Ã“PTIMO) |

**Impacto del Leakage:** Î”RMSE â‰ˆ -1,534 (mejora significativa con pipeline)

### Â¿Por quÃ© Pipeline es Superior?

```python
# Pipeline Anti-Leakage
pipeline = Pipeline([
    ('scaler', StandardScaler()),
    ('model', KNeighborsRegressor())
])

# En cada fold de CV:
# 1. Scaler se ajusta SOLO con datos de training
# 2. Se evalÃºa en datos completamente no vistos
# 3. Evita fuga sutil de informaciÃ³n estadÃ­stica
```

## Pipeline Recomendado Final

```python
mi_mejor_pipeline = Pipeline([
    ('preprocessor', FunctionTransformer(func=safe_log1p)),  # Para variables sesgadas
    ('scaler', StandardScaler()),                            # Escalado estÃ¡ndar
    ('model', LinearRegression())                            # Modelo baseline
])
```

**ValidaciÃ³n:** RÂ² = 0.776 Â± 0.033 (5-fold CV) - Estable y robusto

## AnÃ¡lisis Visual de Transformaciones

### Distribuciones y Outliers

![Distribuciones de Variables Clave](/practico%206/feature-distributions.png)

**Distribuciones de variables clave:** SalePrice y Lot Area muestran fuerte asimetrÃ­a, mientras Overall Qual es aproximadamente normal.

![Boxplots de Outliers](/practico%206/feature-boxplots.png)

**Boxplots revelan outliers extremos** en precios y Ã¡reas, confirmando la necesidad de transformaciones.

### Efectividad de Transformadores

![Log Transform](/practico%206/log-transform-lot-area.png)

**Log transform en Lot Area:** reduce skew de 12.8 a -0.5, normalizando la distribuciÃ³n.

![PowerTransformer](/practico%206/power-transformer-comparison.png)

**PowerTransformer (Yeo-Johnson):** transforma SalePrice a distribuciÃ³n casi perfectamente normal (skew â‰ˆ 0.002).

![QuantileTransformer](/practico%206/quantile-transformer-comparison.png)

**QuantileTransformer:** fuerza normalidad perfecta mapeando cuantiles empÃ­ricos a distribuciÃ³n normal.

## Resultados y Conclusiones

### Principales Hallazgos

- **StandardScaler** fue el mÃ¡s consistente para el dataset Ames Housing
- **PowerTransformer (Yeo-Johnson)** superÃ³ significativamente a scalers bÃ¡sicos en variables sesgadas
- **Log transform** es altamente efectivo para variables como precios y Ã¡reas
- **Data leakage** tiene impacto medible y significativo en el rendimiento
- **Pipeline** es esencial para validaciÃ³n honesta y deployment robusto

### Recomendaciones PrÃ¡cticas

- **Para variables sesgadas:** Aplicar log transform antes del escalado
- **Para outliers:** Detectar y tratar antes de cualquier transformaciÃ³n
- **Para validaciÃ³n:** Usar siempre Pipeline con cross-validation
- **Para producciÃ³n:** Nunca aplicar transformaciones antes del split

## Reflexiones TÃ©cnicas

### Â¿CuÃ¡ndo usar cada transformador?

- **StandardScaler:** Modelos lineales, datos aproximadamente normales
- **RobustScaler:** Presencia moderada de outliers
- **PowerTransformer:** Fuerte asimetrÃ­a, necesidad de normalidad
- **QuantileTransformer:** Distribuciones multimodales o colas extremas

### Orden Ã³ptimo de operaciones:

1. **DetecciÃ³n/tratamiento de outliers**
2. **Transformaciones de forma** (log, Yeo-Johnson)
3. **Escalado** (Standard, MinMax, Robust)
4. **ValidaciÃ³n con Pipeline**

## Aprendizajes Clave

Esta prÃ¡ctica consolidÃ³ conceptos fundamentales sobre:

- **La criticidad del orden de operaciones** en preprocessing
- **El impacto real del data leakage** en mÃ©tricas de evaluaciÃ³n
- **La superioridad de transformadores avanzados** para datos no ideales
- **La importancia de Pipeline** para workflows reproducibles y robustos

## Bonus: AnÃ¡lisis Avanzado

En esta secciÃ³n adicional, exploramos tÃ©cnicas avanzadas de feature engineering y anÃ¡lisis comparativo mÃ¡s profundo de las transformaciones. Se implementan visualizaciones detalladas que muestran el impacto especÃ­fico de cada transformador en las distribuciones de datos, anÃ¡lisis de correlaciones antes y despuÃ©s de las transformaciones, y comparaciones lado a lado de mÃºltiples tÃ©cnicas de escalado.

**Descarga el notebook completo del bonus:** [PrÃ¡ctica 6 Bonus - AnÃ¡lisis Avanzado](#)

### AnÃ¡lisis Exhaustivo de Distribuciones

![Distribuciones Completas del Dataset](/practico%206/distributions-complete.png)

**Histogramas de todas las variables numÃ©ricas** del dataset Ames Housing mostrando la diversidad de formas y escalas presentes en los datos originales.

### Distribuciones Normalizadas por Variable

![Distribuciones Individuales](/practico%206/distributions-individual.png)

**AnÃ¡lisis detallado de las distribuciones** de variables clave, destacando patrones de asimetrÃ­a, multimodalidad y presencia de valores extremos.

### AnÃ¡lisis Completo de Outliers por Boxplots

![Boxplots Exhaustivos](/practico%206/boxplots-complete.png)

**VisualizaciÃ³n completa mediante boxplots** de todas las variables numÃ©ricas, revelando la extensiÃ³n y naturaleza de los valores atÃ­picos en cada feature.

### ComparaciÃ³n Detallada de Boxplots

![Boxplots por Variable](/practico%206/boxplots-detailed.png)

**AnÃ¡lisis individualizado de boxplots** para cada variable, permitiendo identificar patrones especÃ­ficos de outliers y rangos intercuartÃ­licos.

## Reporte de Transformaciones NumÃ©ricas

| Variable | TransformaciÃ³n | Notas / JustificaciÃ³n |
|----------|----------------|----------------------|
| Order | Drop | ID / Ã­ndice, sin valor analÃ­tico |
| PID | Drop | Identificador Ãºnico |
| MS SubClass | none / categ. | Mejor tratar como categÃ³rica (clase de vivienda) |
| Lot Frontage | log1p | Positivos, cola larga, valores atÃ­picos |
| Lot Area | log1p | DistribuciÃ³n muy sesgada a derecha |
| Overall Qual | minmax | Escala ordinal 1â€“10 |
| Overall Cond | minmax | Escala ordinal 1â€“9 |
| Year Built | â†’ HouseAge std | Convertido a edad (Yr Sold - Built), escalado estÃ¡ndar |
| Year Remod/Add | â†’ RemodAge std | Convertido a edad de remodelaciÃ³n, escalado estÃ¡ndar |
| BsmtFin SF 1 | log1p | Sesgo fuerte, valores extremos |
| BsmtFin SF 2 | log1p | Muchos ceros, sesgo a derecha |
| Bsmt Unf SF | log1p | Sesgo fuerte, gran dispersiÃ³n |
| Total Bsmt SF | log1p | Colas largas, magnitudes muy grandes |
| 1st Flr SF | log1p | Sesgo fuerte, outliers |
| 2nd Flr SF | log1p | Sesgo fuerte, muchos ceros |
| Low Qual Fin SF | log1p + gt0 | Cero-inflada, indicador + transformaciÃ³n |
| Gr Liv Area | log1p | Muy sesgada, valores grandes |
| Bsmt Full Bath | none | Valores pequeÃ±os enteros, discreta |
| Bsmt Half Bath | none | Muy pocos valores distintos, discreta |
| Full Bath | minmax | Ordinal con pocos valores enteros |
| Half Bath | minmax | Ordinal con pocos valores enteros |
| Bedroom AbvGr | minmax | Ordinal discreta |
| Kitchen AbvGr | minmax | Muy pocos valores distintos (casi constante) |
| TotRms AbvGrd | robust | SimÃ©trica con outliers, robust scaler adecuado |
| Fireplaces | minmax | Discreta con rango pequeÃ±o |
| Garage Yr Blt | â†’ GarageAge std | Convertido a edad, estandarizado |
| Garage Cars | minmax | Discreta, 0â€“4 autos |
| Garage Area | log1p | Sesgada a derecha |
| Wood Deck SF | log1p + gt0 | Cero-inflada |
| Open Porch SF | log1p + gt0 | Cero-inflada |
| Enclosed Porch | log1p + gt0 | Cero-inflada |
| 3Ssn Porch | log1p + gt0 | Cero-inflada |
| Screen Porch | log1p + gt0 | Cero-inflada |
| Pool Area | log1p + gt0 | Cero-inflada |
| Misc Val | log1p + gt0 | Mayormente ceros, pocos valores grandes |
| Mo Sold | minmax | Mes (1â€“12), ordinal circular |
| Yr Sold | standard | AÃ±o de venta, centrado y escalado |
| SalePrice (target) | log1p | Muy sesgado, transformaciÃ³n clÃ¡sica en Kaggle |

**ğŸ“Œ Indicadores *_gt0:** columnas adicionales que marcan la presencia (>0) en variables cero-infladas, para complementar el valor transformado.

**ğŸ“Œ AÃ±os:** Year Built, Year Remod/Add, Garage Yr Blt se convirtieron en edades relativas a Yr Sold, lo que tiene mÃ¡s sentido analÃ­tico.