---
title: "Pr치ctica 4"
date: 2025-08-27
order: 4
---

# Pr치ctica 4: EDA Multi-fuentes y Joins - Pipeline con Prefect


- **Pr치ctica**: 04 - EDA Multi-fuentes y Joins
- **Fecha**: 27/08/2025
- **Entorno**: Python + Pandas + Prefect
- **Tipo**: Pipeline de Datos + An치lisis Exploratorio
- **Autores**: G1: Joaqu칤n Batista, Milagros Cancela, Valent칤n Rodr칤guez, Alexia Aurrecoechea, Nahuel L칩pez
- **Dataset**: NYC Taxi (3+ millones de registros) + Zonas + Calendario

*Este proyecto demuestra la integraci칩n exitosa de m칰ltiples fuentes de datos a escala metropolitana, combinando an치lisis exploratorio avanzado con automatizaci칩n robusta para generar insights empresariales accionables.*

游늽 **Notebook Completo** - Jupyter Notebook con todo el c칩digo y an치lisis disponible en el repositorio del curso

---

## 游꿢 Objetivos y Alcance

### **Objetivos Principales**
- **Integraci칩n de datos**: Combinar m칰ltiples fuentes de datos oficiales (NYC Taxi, Zonas, Calendario)
- **Joins avanzados**: Dominar diferentes tipos de joins con pandas en datasets grandes
- **Pipeline automatizado**: Implementar workflow con Prefect para an치lisis robusto
- **An치lisis empresarial**: Generar insights de negocio a partir de datos integrados

### **Caso de Negocio**
La comisi칩n de taxis de NYC necesita an치lisis en tiempo real de **3+ millones de viajes mensuales** para:

- Optimizar distribuci칩n de flota por zonas y horarios
- Entender patrones de demanda en eventos especiales
- Tomar decisiones estrat칠gicas basadas en datos reales a escala metropolitana

---

## 游늵 Fuentes de Datos Integradas

### **1. NYC Taxi Dataset** 
- **Origen**: [NYC Taxi & Limousine Commission](https://www.nyc.gov/assets/tlc/downloads/pdf/trip_record_data_user_guide.pdf)
- **Registros**: 3,066,766 viajes (Enero 2023)
- **Formato**: Parquet (565.6 MB)
- **Variables clave**: `pickup_datetime`, `dropoff_datetime`, `trip_distance`, `total_amount`, `tip_amount`

### **2. NYC Taxi Zones**
- **Origen**: [NYC Zones Lookup](https://www.nyc.gov/assets/tlc/downloads/pdf/taxi_zone_lookup.pdf)
- **Registros**: 265 zonas geogr치ficas
- **Variables**: `LocationID`, `Borough`, `Zone`, `service_zone`

### **3. Calendario de Eventos**
- **Origen**: Dataset personalizado JSON
- **Registros**: Eventos especiales y d칤as festivos
- **Variables**: `date`, `name`, `special` (boolean)

---

## 游댢 Metodolog칤a y Desarrollo

### **Etapa 1: Setup y Carga de Datos**
```python
# Optimizaci칩n para datasets grandes (~3M registros)
trips = pd.read_parquet(trips_url)  # M치s eficiente que CSV
zones = pd.read_csv(zones_url)
calendar = pd.read_json(calendar_url)

# Normalizaci칩n de tipos de datos para joins
trips['pulocationid'] = trips['pulocationid'].astype('int16')
zones['locationid'] = zones['locationid'].astype('int16')
```

### **Etapa 2: Joins Multi-fuentes**
```python
# JOIN 1: Trips + Zones (Inner Join)
trips_with_zones = pd.merge(trips, zones, 
                           left_on="pulocationid", 
                           right_on="locationid", 
                           how="inner")

# JOIN 2: + Calendar (Left Join para mantener todos los trips)
trips_complete = trips_with_zones.merge(calendar,
                                       left_on="pickup_date",
                                       right_on="date", 
                                       how="left")
```

### **Etapa 3: Pipeline con Prefect**
```python
@task(name="Cargar Datos", retries=2, retry_delay_seconds=3)
def cargar_datos(url: str, tipo: str) -> pd.DataFrame:
    """Task robusto para cargar datos con retry autom치tico"""
    # Implementaci칩n con manejo de errores y logging

@flow(name="Pipeline Simple NYC Taxi")
def pipeline_taxi_simple():
    """Flow que conecta todos los tasks"""
    # Pipeline completo con logging y monitoreo
```

---

## 游늳 Resultados y Hallazgos

### **Estad칤sticas Generales del Dataset Integrado**
- **Total de registros procesados**: 3,066,766 viajes
- **Tasa de match geogr치fico**: 99.6% (3,055,808 viajes con zona asignada)
- **Cobertura de zonas**: 97.7% (259 de 265 zonas utilizadas)
- **Memoria optimizada**: 8.1% de ahorro tras optimizaci칩n de tipos

### **An치lisis por Borough (Top Insights)**

| Borough | Viajes | Market Share | Distancia Promedio | Tarifa Promedio | Revenue/km |
|---------|--------|--------------|-------------------|----------------|------------|
| **Manhattan** | 2,725,880 | 89.2% | 3.19 mi | $23.86 | $7.48 |
| **Queens** | 161,624 | 5.3% | 8.81 mi | $49.50 | $5.62 |
| **Brooklyn** | 118,902 | 3.9% | 9.06 mi | $50.10 | $5.53 |
| **Bronx** | 18,313 | 0.6% | 10.33 mi | $52.85 | $5.12 |

### **Patrones Temporales Identificados**
- **Horas pico**: 18:00 (215,889 viajes), 17:00 (209,493 viajes), 15:00 (196,424 viajes)
- **Concentraci칩n metropolitana**: Manhattan domina con 89.2% del mercado
- **Oportunidades de expansi칩n**: Bronx y Staten Island con baja cobertura

### **Correlaciones Clave Descubiertas**
- **Total vs Fare Amount**: 0.980 (correlaci칩n muy fuerte)
- **Total vs Tip Amount**: 0.710 (correlaci칩n fuerte)
- **Fare vs Tip Amount**: 0.590 (correlaci칩n moderada)

---

## 游눺 Insights de Negocio

### **游꿢 Oportunidades Estrat칠gicas**
1. **Optimizaci칩n de flota**: Reforzar disponibilidad en Manhattan durante horas pico (17:00-18:00)
2. **Expansi칩n geogr치fica**: Invertir en cobertura de Bronx y Staten Island (mercados subatendidos)
3. **Pricing din치mico**: Manhattan puede soportar tarifas premium por su alta demanda

### **游늵 KPIs Empresariales Calculados**
- **Revenue por kil칩metro**: Manhattan lidera con $7.48/km
- **Tasa de propinas**: Manhattan 19.7%, Queens 14.6%
- **Eficiencia operativa**: 99.6% de viajes con geo-localizaci칩n exitosa

### **游댃 Recomendaciones para Pipeline en Producci칩n**
- **Automatizaci칩n**: Ejecutar an치lisis diarios con Prefect
- **Alertas**: Monitoreo en tiempo real de anomal칤as en patrones de viaje
- **Escalabilidad**: Pipeline preparado para manejar 3M+ registros mensuales

---

## 游 Implementaci칩n con Prefect

### **Ventajas del Pipeline Automatizado**
- **Robustez**: Retry autom치tico si falla la carga de datos
- **Observabilidad**: Logging completo de cada paso del proceso
- **Modularidad**: Tasks reutilizables para diferentes an치lisis
- **Escalabilidad**: Preparado para ejecuti칩n programada y paralela

### **Resultados del Pipeline**

```python
# Ejecuci칩n exitosa del flow completo
Total registros: 3,066,766
Distancia promedio: 3.85 millas  
Tarifa promedio: $27.02
Top Borough: Manhattan (2,715,369 viajes)
```

![Dashboard Prefect](../../public/prefect-dashboard.png)

*Dashboard de Prefect mostrando los flows ejecutados y tasks completados.*

### **Reflexiones sobre Prefect**

**쯈u칠 ventaja tiene usar @task en lugar de una funci칩n normal?**

- Permite reintentos autom치ticos, manejo de errores y monitoreo. Si la carga falla, Prefect puede reintentar el task seg칰n lo configurado.

**쯇ara qu칠 sirve el @flow decorator?**

- Define y organiza el pipeline, conectando tasks en un flujo l칩gico y permitiendo su ejecuci칩n secuencial o paralela.

**쮼n qu칠 casos reales usar칤as esto?**

- Automatizaci칩n de reportes, an치lisis recurrentes, ETL, procesamiento de datos, y entrenamiento de modelos de machine learning.

---

## 游닇 Reflexiones y Aprendizajes

### **Challenges T칠cnicos Superados**
1. **Optimizaci칩n de memoria**: Reducci칩n del 8.1% optimizando tipos de datos
2. **Joins complejos**: Manejo de 3M+ registros con m칰ltiples fuentes

### **Metodolog칤a CRISP-DM Aplicada**
- **Entendimiento del Negocio**: Identificaci칩n de necesidades de la comisi칩n de taxis
- **Entendimiento de los Datos**: Exploraci칩n de 3 fuentes heterog칠neas
- **Preparaci칩n de los Datos**: Normalizaci칩n y limpieza para joins efectivos
- **Modelado de los Datos**: An치lisis agregado por dimensiones geogr치ficas y temporales

### **Escalabilidad y Producci칩n**
El pipeline desarrollado est치 preparado para:

- Procesamiento autom치tico de datasets mensuales
- Integraci칩n con sistemas en tiempo real
- Expansi칩n a otras ciudades y tipos de transporte

---

## 游댕 Enlaces y Referencias

- **NYC TLC Trip Record Data**: [Datos oficiales de NYC Taxi & Limousine Commission](https://www.nyc.gov/site/tlc/about/tlc-trip-record-data.page)
- **Data Dictionary Yellow Taxi**: [Diccionario de datos oficial Yellow Taxi](https://www.nyc.gov/assets/tlc/downloads/pdf/data_dictionary_trip_records_yellow.pdf)
- **Pandas Merge Documentation**: [Documentaci칩n oficial de pandas.merge()](https://pandas.pydata.org/docs/reference/api/pandas.merge.html)
- **Material del curso**: [EDA Multi-fuentes y Joins](https://juanfkurucz.com/ucu-id/ut1/04-eda-multifuentes-joins/)